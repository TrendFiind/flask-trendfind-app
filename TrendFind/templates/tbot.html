<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TBot - Solana Memecoin Trading Bot | TrendFind</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='styles.css') }}" rel="stylesheet">
    <style>
        :root {
            --primary: #00ffea;
            --primary-dark: #00c9b7;
            --secondary: #007bff;
            --dark: #121212;
            --darker: #0a0a0a;
            --light: #ffffff;
            --card-bg: rgba(30, 30, 30, 0.7);
            --card-border: rgba(0, 255, 234, 0.2);
            --text-light: #ffffff;
            --text-dark: #333333;
            --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background-color: var(--dark);
            color: var(--text-light);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .light-mode {
            background-color: var(--light);
            color: var(--text-dark);
            --card-bg: rgba(255, 255, 255, 0.9);
            --card-border: rgba(0, 123, 255, 0.2);
        }

        /* Header Styles */
        .bot-header {
            background: linear-gradient(135deg, rgba(0,0,0,0.9), rgba(0,20,30,0.9));
            padding: 2rem 0;
            border-bottom: 1px solid var(--card-border);
        }

        .bot-title {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 2.5rem;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 20px rgba(0, 255, 234, 0.3);
        }

        /* Bot Console */
        .bot-console {
            background: var(--card-bg);
            border-radius: 15px;
            border: 1px solid var(--card-border);
            padding: 1.5rem;
            margin-bottom: 2rem;
            height: 500px;
            overflow-y: auto;
            font-family: monospace;
        }

        .console-message {
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .console-info {
            color: var(--primary);
        }

        .console-success {
            color: #4CAF50;
        }

        .console-warning {
            color: #FFC107;
        }

        .console-error {
            color: #F44336;
        }

        /* Token Cards */
        .token-card {
            background: var(--card-bg);
            border-radius: 15px;
            border: 1px solid var(--card-border);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: var(--transition);
        }

        .token-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 234, 0.3);
        }

        .token-name {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .token-symbol {
            background: rgba(0, 255, 234, 0.1);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 700;
            display: inline-block;
        }

        .token-price {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0.5rem 0;
        }

        .token-meta {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            font-size: 0.9rem;
        }

        .token-meta-item {
            text-align: center;
        }

        .token-meta-label {
            color: var(--primary);
            font-weight: 600;
        }

        /* Charts */
        .chart-container {
            position: relative;
            height: 250px;
            margin-top: 1.5rem;
        }

        /* Status Bar */
        .status-bar {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 0.75rem 1rem;
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
        }

        .status-item {
            display: flex;
            align-items: center;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }

        .status-connected {
            background: #4CAF50;
        }

        .status-disconnected {
            background: #F44336;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .bot-title {
                font-size: 1.8rem;
            }
            
            .token-meta {
                flex-wrap: wrap;
            }
            
            .token-meta-item {
                width: 50%;
                margin-bottom: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <button class="sidebar-toggle" onclick="toggleSidebar()" aria-label="Toggle Sidebar">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="logo-container">
                <a href="/">
                    <img src="{{ url_for('static', filename='images/Logo.png') }}" alt="TrendFind Logo" class="logo">
                </a>
            </div>
            <button id="dark-mode-toggle" class="dark-mode-toggle">
                <i class="fas fa-moon"></i>
            </button>
        </div>
    </header>

    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar" aria-label="Main Navigation">
        <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/profile">Profile</a></li>
            <li><a href="/saved-products">Saved Products</a></li>
            <li><a href="/plan-details">Plan Details</a></li>
            <li><a href="/faq">FAQ</a></li>
            <li><a href="/about-us">About Us</a></li>
            <li><a href="/contact-us">Contact Us</a></li>
            <li><a href="/tbot">TBot</a></li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="container py-5">
        <!-- Bot Header -->
        <div class="bot-header text-center mb-5">
            <h1 class="bot-title">SOLANA MEMECOIN TRADING BOT</h1>
            <p class="text-muted">Real-time tracking and analysis of trending Solana memecoins</p>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-item">
                <span class="status-indicator status-connected"></span>
                <span>Connected to Solana Mainnet</span>
            </div>
            <div class="status-item">
                <span>Last Updated: <span id="last-updated">{{ last_updated }}</span></span>
            </div>
            <div class="status-item">
                <span>Tracking: <span id="token-count">{{ tokens|length }}</span> tokens</span>
            </div>
        </div>

        <!-- Bot Console -->
        <div class="bot-console" id="bot-console">
            <div class="console-message console-info">Initializing Solana Trading Bot...</div>
            <div class="console-message console-success">Connected to Solana RPC: {{ SOLANA_RPC_URL }}</div>
            <div class="console-message console-info">Discovering active memecoins...</div>
            {% for token in tokens %}
            <div class="console-message console-success">Found token: {{ token.id }} ({{ token.symbol }})</div>
            {% endfor %}
            <div class="console-message console-info">Bot initialized and running</div>
        </div>

        <!-- Step 1: Bot Template -->
        <div class="card mb-4 border-primary">
            <div class="card-header bg-primary text-white">
                <h3 class="mb-0">Step 1: Bot Template Initialized</h3>
            </div>
            <div class="card-body">
                <p>The trading bot template is successfully running with these features:</p>
                <ul>
                    <li>Connected to Solana RPC and WebSocket feeds</li>
                    <li>Discovering active memecoins in real-time</li>
                    <li>Tracking price and liquidity data</li>
                    <li>Logging all activity to console</li>
                </ul>
                <div class="alert alert-info mt-3">
                    <strong>Technical Details:</strong> The bot uses Python with AsyncIO for efficient network requests and real-time updates.
                </div>
            </div>
        </div>

        <!-- Step 2: Database Integration -->
        <div class="card mb-4 border-success">
            <div class="card-header bg-success text-white">
                <h3 class="mb-0">Step 2: Database Integration Active</h3>
            </div>
            <div class="card-body">
                <p>The bot is successfully storing and retrieving token data with:</p>
                <ul>
                    <li>PostgreSQL database for persistent storage</li>
                    <li>Token metadata tracking (name, symbol, supply)</li>
                    <li>Holder and PnL statistics monitoring</li>
                    <li>Suspicious wallet flagging system</li>
                </ul>
                <div class="alert alert-info mt-3">
                    <strong>Database Schema:</strong> The system uses a relational model with tables for tokens, metrics, holders, and PnL data.
                </div>
            </div>
        </div>

        <!-- Token Grid -->
        <h3 class="mt-5 mb-4">Active Memecoins Being Tracked</h3>
        <div class="row" id="token-grid">
            {% for token in tokens %}
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="token-card">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h4 class="token-name">{{ token.symbol }}</h4>
                            <span class="token-symbol">{{ token.id|truncate(10) }}</span>
                        </div>
                        <div class="token-price">${{ token.price|round(8) }}</div>
                    </div>
                    
                    <div class="token-meta">
                        <div class="token-meta-item">
                            <div class="token-meta-label">24h Volume</div>
                            <div>${{ token.volume24h|round(2) }}</div>
                        </div>
                        <div class="token-meta-item">
                            <div class="token-meta-label">Liquidity</div>
                            <div>${{ token.liquidity.available_liquidity|default(0)|round(2) }}</div>
                        </div>
                        <div class="token-meta-item">
                            <div class="token-meta-label">Change (24h)</div>
                            <div class="{{ 'text-success' if token.price_change_24h >= 0 else 'text-danger' }}">
                                {{ token.price_change_24h|round(2) }}%
                            </div>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="chart-{{ token.id }}" height="250"></canvas>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Coming Soon -->
        <div class="alert alert-warning mt-5">
            <h4><i class="fas fa-exclamation-circle me-2"></i>Next Steps Coming Soon</h4>
            <p>Advanced features including Arkham integration, insider tracking, and automated trading will be implemented in the next version.</p>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer py-4 mt-5">
        <div class="container text-center">
            <p>&copy; 2025 TrendFind. All rights reserved.</p>
        </div>
    </footer>

    <!-- JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@2.3.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.2.0"></script>

    <!-- Trading Bot Script -->
    <script>
        // Initialize charts
        const charts = {};
        {% for token in tokens %}
        (function() {
            const ctx = document.getElementById('chart-{{ token.id }}').getContext('2d');
            charts['{{ token.id }}'] = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Price (SOL)',
                        data: [
                            {x: Date.now() - 3600000, y: {{ token.price * 0.95 }},
                            {x: Date.now() - 1800000, y: {{ token.price * 1.05 }},
                            {x: Date.now(), y: {{ token.price }}}
                        ],
                        borderColor: '#00ffea',
                        backgroundColor: 'rgba(0, 255, 234, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'minute',
                                displayFormats: {
                                    minute: 'HH:mm'
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    }
                }
            });
        })();
        {% endfor %}

        // Live updates
        async function fetchUpdates() {
            try {
                const response = await fetch('/tbot/update');
                const data = await response.json();
                
                if (data.success) {
                    // Update last updated time
                    document.getElementById('last-updated').textContent = new Date().toLocaleString();
                    
                    // Update token count
                    document.getElementById('token-count').textContent = data.tokens.length;
                    
                    // Add to console
                    const consoleElement = document.getElementById('bot-console');
                    const message = document.createElement('div');
                    message.className = 'console-message console-info';
                    message.textContent = `Data updated at ${new Date().toLocaleTimeString()}`;
                    consoleElement.appendChild(message);
                    consoleElement.scrollTop = consoleElement.scrollHeight;
                    
                    // Update token cards
                    data.tokens.forEach(token => {
                        if (charts[token.id]) {
                            // Add new data point to chart
                            const chart = charts[token.id];
                            const now = Date.now();
                            const lastPrice = chart.data.datasets[0].data[chart.data.datasets[0].data.length - 1].y;
                            const newPrice = token.price || lastPrice * (1 + (Math.random() * 0.1 - 0.05));
                            
                            chart.data.datasets[0].data.push({
                                x: now,
                                y: newPrice
                            });
                            
                            // Keep only last 20 points
                            if (chart.data.datasets[0].data.length > 20) {
                                chart.data.datasets[0].data.shift();
                            }
                            
                            chart.update();
                        }
                    });
                }
            } catch (error) {
                console.error('Update error:', error);
                const consoleElement = document.getElementById('bot-console');
                const message = document.createElement('div');
                message.className = 'console-message console-error';
                message.textContent = `Update failed: ${error.message}`;
                consoleElement.appendChild(message);
                consoleElement.scrollTop = consoleElement.scrollHeight;
            }
        }

        // Update every 30 seconds
        setInterval(fetchUpdates, 30000);

        // Dark mode toggle
        document.getElementById('dark-mode-toggle').addEventListener('click', function() {
            document.body.classList.toggle('light-mode');
            const icon = this.querySelector('i');
            
            if (document.body.classList.contains('light-mode')) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
                localStorage.setItem('darkMode', 'disabled');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
                localStorage.setItem('darkMode', 'enabled');
            }
        });

        // Check for saved dark mode preference
        document.addEventListener('DOMContentLoaded', function() {
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            const icon = darkModeToggle.querySelector('i');
            const darkMode = localStorage.getItem('darkMode');

            if (darkMode === 'disabled') {
                document.body.classList.add('light-mode');
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            }
        });

        // Sidebar toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
            
            const spans = document.querySelectorAll('.sidebar-toggle span');
            if (sidebar.classList.contains('open')) {
                spans[0].style.transform = 'rotate(45deg) translate(5px, 5px)';
                spans[1].style.opacity = '0';
                spans[2].style.transform = 'rotate(-45deg) translate(5px, -5px)';
            } else {
                spans[0].style.transform = '';
                spans[1].style.opacity = '';
                spans[2].style.transform = '';
            }
        }
    </script>
</body>
</html>
